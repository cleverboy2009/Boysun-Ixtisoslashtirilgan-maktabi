<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel — Kelajak Soati</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="../favicon.png">
    <style>
        :root {
            --bg: #04050f;
            --surface: #0b0d1e;
            --glass: rgba(15, 18, 40, .65);
            --border: rgba(255, 255, 255, .08);
            --border-h: rgba(255, 255, 255, .18);
            --text: #f0f4ff;
            --muted: #8892b0;
            --dim: #4a5568;
            --green: #22c55e;
            --green2: #16a34a;
            --green-g: rgba(34, 197, 94, .25);
            --blue: #0072ff;
            --blue-g: rgba(0, 114, 255, .25);
            --red: #ef4444;
            --red-g: rgba(239, 68, 68, .2);
            --yellow: #f59e0b;
            --radius: 16px;
            --font: 'Inter', sans-serif;
        }

        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        html {
            scroll-behavior: smooth
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: var(--font);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 260px;
            min-height: 100vh;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            z-index: 100;
            transition: transform .3s ease;
        }

        .sidebar-logo {
            padding: 1.75rem 1.5rem 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-mark {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--green), var(--green2));
            display: grid;
            place-items: center;
            font-size: 1.1rem;
            color: #fff;
            flex-shrink: 0;
            box-shadow: 0 6px 18px var(--green-g);
        }

        .logo-text {
            font-size: .95rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .logo-text small {
            display: block;
            font-size: .7rem;
            color: var(--muted);
            font-weight: 400;
        }

        .sidebar-nav {
            padding: 1rem 0.75rem;
            flex: 1;
        }

        .nav-section {
            font-size: .65rem;
            font-weight: 700;
            color: var(--dim);
            letter-spacing: 1.5px;
            text-transform: uppercase;
            padding: 1rem .75rem .4rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 12px;
            font-size: .9rem;
            font-weight: 500;
            color: var(--muted);
            cursor: pointer;
            transition: all .25s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-item i {
            width: 18px;
            text-align: center;
            font-size: .95rem;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, .05);
            color: var(--text);
        }

        .nav-item.active {
            background: rgba(34, 197, 94, .12);
            color: var(--green);
        }

        .nav-item.active i {
            color: var(--green);
        }

        .sidebar-footer {
            padding: 1rem .75rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .user-chip {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: .75rem 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, .03);
            margin-bottom: .75rem;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--green), var(--blue));
            display: grid;
            place-items: center;
            font-size: .85rem;
            color: #fff;
            flex-shrink: 0;
        }

        .user-name {
            font-size: .82rem;
            font-weight: 600;
        }

        .user-role {
            font-size: .7rem;
            color: var(--muted);
        }

        .logout-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 9px 12px;
            border-radius: 10px;
            background: rgba(239, 68, 68, .1);
            border: 1px solid rgba(239, 68, 68, .2);
            color: var(--red);
            font-family: var(--font);
            font-size: .85rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all .25s;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, .2);
        }

        /* ===== MAIN ===== */
        .main {
            margin-left: 260px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .topbar {
            height: 65px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            background: rgba(4, 5, 15, .8);
            backdrop-filter: blur(12px);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .topbar-title {
            font-size: 1.05rem;
            font-weight: 700;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .grade-tabs {
            display: flex;
            gap: .5rem;
        }

        .grade-tab {
            padding: 6px 16px;
            border-radius: 50px;
            font-size: .82rem;
            font-weight: 600;
            border: 1px solid var(--border);
            background: none;
            color: var(--muted);
            cursor: pointer;
            transition: all .25s;
            font-family: var(--font);
        }

        .grade-tab.active {
            background: var(--green);
            color: #fff;
            border-color: transparent;
            box-shadow: 0 4px 12px var(--green-g);
        }

        .content {
            padding: 2rem;
            flex: 1;
        }

        /* ===== STATS ===== */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem 1.5rem;
            backdrop-filter: blur(10px);
        }

        .stat-label {
            font-size: .75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: .5px;
            margin-bottom: .4rem;
        }

        .stat-num {
            font-size: 2rem;
            font-weight: 800;
            font-family: 'Inter', sans-serif;
        }

        .stat-card:nth-child(1) .stat-num {
            color: var(--green);
        }

        .stat-card:nth-child(2) .stat-num {
            color: var(--blue);
        }

        .stat-card:nth-child(3) .stat-num {
            color: var(--yellow);
        }

        .stat-card:nth-child(4) .stat-num {
            color: #a855f7;
        }

        /* ===== PANEL SECTIONS ===== */
        .panel {
            display: none;
        }

        .panel.active {
            display: block;
        }

        /* ===== TABLE ===== */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
        }

        .section-header h2 {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .add-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 9px 20px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--green), var(--green2));
            color: #fff;
            font-family: var(--font);
            font-size: .85rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all .3s;
            box-shadow: 0 4px 12px var(--green-g);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--green-g);
        }

        .table-wrap {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(255, 255, 255, .03);
        }

        th {
            text-align: left;
            padding: 12px 16px;
            font-size: .75rem;
            font-weight: 700;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: .5px;
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 13px 16px;
            border-bottom: 1px solid var(--border);
            font-size: .88rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: rgba(255, 255, 255, .02);
        }

        .badge-hafta {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(34, 197, 94, .12);
            color: var(--green);
            border-radius: 50px;
            padding: 3px 10px;
            font-size: .75rem;
            font-weight: 700;
        }

        .topic-title-cell {
            font-weight: 600;
            max-width: 220px;
        }

        .topic-qisqa-cell {
            color: var(--muted);
            font-size: .8rem;
            max-width: 280px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .action-btns {
            display: flex;
            gap: .5rem;
        }

        .btn-icon {
            width: 34px;
            height: 34px;
            border-radius: 9px;
            border: none;
            display: grid;
            place-items: center;
            cursor: pointer;
            font-size: .85rem;
            transition: all .25s;
        }

        .btn-edit {
            background: rgba(0, 114, 255, .12);
            color: var(--blue);
        }

        .btn-edit:hover {
            background: var(--blue);
            color: #fff;
        }

        .btn-del {
            background: rgba(239, 68, 68, .1);
            color: var(--red);
        }

        .btn-del:hover {
            background: var(--red);
            color: #fff;
        }

        .empty-row td {
            text-align: center;
            padding: 3rem;
            color: var(--muted);
        }

        /* ===== LOGS TABLE ===== */
        .log-entry {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-icon {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            display: grid;
            place-items: center;
            font-size: .85rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .log-icon.add {
            background: rgba(34, 197, 94, .15);
            color: var(--green);
        }

        .log-icon.edit {
            background: rgba(0, 114, 255, .12);
            color: var(--blue);
        }

        .log-icon.del {
            background: rgba(239, 68, 68, .1);
            color: var(--red);
        }

        .log-icon.login {
            background: rgba(168, 85, 247, .12);
            color: #a855f7;
        }

        .log-body {
            flex: 1;
        }

        .log-msg {
            font-size: .87rem;
            font-weight: 500;
        }

        .log-time {
            font-size: .72rem;
            color: var(--muted);
            margin-top: 2px;
        }

        .log-grade-badge {
            font-size: .7rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 50px;
            background: rgba(34, 197, 94, .1);
            color: var(--green);
            flex-shrink: 0;
        }

        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity .3s;
        }

        .modal-overlay.open {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background: #0d0f20;
            border: 1px solid var(--border-h);
            border-radius: 24px;
            padding: 2rem;
            width: 100%;
            max-width: 580px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 40px 100px rgba(0, 0, 0, .6);
            transform: scale(.95) translateY(20px);
            transition: transform .3s ease;
        }

        .modal-overlay.open .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.75rem;
        }

        .modal-title {
            font-size: 1.15rem;
            font-weight: 800;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: none;
            color: var(--muted);
            cursor: pointer;
            font-size: 1rem;
            display: grid;
            place-items: center;
            transition: all .25s;
        }

        .modal-close:hover {
            background: var(--red);
            color: #fff;
            border-color: transparent;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1.1rem;
        }

        .form-group label {
            display: block;
            font-size: .78rem;
            font-weight: 600;
            color: var(--muted);
            margin-bottom: .45rem;
            letter-spacing: .3px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 11px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, .04);
            color: var(--text);
            font-family: var(--font);
            font-size: .9rem;
            outline: none;
            transition: border-color .3s, box-shadow .3s;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--green);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, .1);
        }

        .form-group select option {
            background: #0d0f20;
        }

        .color-row {
            display: flex;
            align-items: center;
            gap: .75rem;
        }

        .color-row input[type=color] {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            padding: 2px;
            border: 1px solid var(--border);
            cursor: pointer;
        }

        .color-presets {
            display: flex;
            gap: .4rem;
            flex-wrap: wrap;
        }

        .cp {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: transform .2s;
        }

        .cp:hover {
            transform: scale(1.2);
        }

        .modal-footer {
            display: flex;
            gap: .75rem;
            margin-top: 1.5rem;
            justify-content: flex-end;
        }

        .btn-cancel {
            padding: 10px 22px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: none;
            color: var(--muted);
            font-family: var(--font);
            font-size: .88rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .25s;
        }

        .btn-cancel:hover {
            border-color: var(--border-h);
            color: var(--text);
        }

        .btn-save {
            padding: 10px 28px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, var(--green), var(--green2));
            color: #fff;
            font-family: var(--font);
            font-size: .88rem;
            font-weight: 700;
            cursor: pointer;
            transition: all .3s;
            box-shadow: 0 4px 12px var(--green-g);
        }

        .btn-save:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px var(--green-g);
        }

        /* ===== CONFIRM ===== */
        .confirm-box {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .7);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .confirm-box.open {
            display: flex;
        }

        .confirm-card {
            background: #0d0f20;
            border: 1px solid rgba(239, 68, 68, .3);
            border-radius: 20px;
            padding: 2rem;
            max-width: 360px;
            width: 100%;
            text-align: center;
            box-shadow: 0 30px 60px rgba(0, 0, 0, .5);
        }

        .confirm-card .conf-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(239, 68, 68, .1);
            color: var(--red);
            font-size: 1.5rem;
            display: grid;
            place-items: center;
            margin: 0 auto 1rem;
        }

        .confirm-card h3 {
            font-size: 1.1rem;
            margin-bottom: .5rem;
        }

        .confirm-card p {
            color: var(--muted);
            font-size: .88rem;
            margin-bottom: 1.5rem;
        }

        .confirm-btns {
            display: flex;
            gap: .75rem;
            justify-content: center;
        }

        .btn-no {
            padding: 9px 22px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: none;
            color: var(--muted);
            cursor: pointer;
            font-family: var(--font);
            font-size: .85rem;
            font-weight: 600;
            transition: all .25s;
        }

        .btn-no:hover {
            border-color: var(--border-h);
            color: var(--text);
        }

        .btn-yes {
            padding: 9px 22px;
            border-radius: 10px;
            border: none;
            background: var(--red);
            color: #fff;
            cursor: pointer;
            font-family: var(--font);
            font-size: .85rem;
            font-weight: 700;
            transition: all .25s;
        }

        .btn-yes:hover {
            background: #dc2626;
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 12px 20px;
            border-radius: 14px;
            font-size: .88rem;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .3);
            z-index: 9999;
            transform: translateX(120%);
            transition: transform .35s cubic-bezier(.2, .8, .2, 1);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: linear-gradient(135deg, var(--green), var(--green2));
        }

        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .toast.info {
            background: linear-gradient(135deg, #0072ff, #0050cc);
        }

        /* ===== RESPONSIVE ===== */
        @media(max-width:900px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main {
                margin-left: 0;
            }

            .stats-row {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media(max-width:600px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-row {
                grid-template-columns: 1fr 1fr;
                gap: .75rem;
            }
        }
    </style>
</head>

<body>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-logo">
            <div class="logo-mark"><i class="fas fa-rocket"></i></div>
            <div class="logo-text">Kelajak Soati<small>Admin Panel</small></div>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">Asosiy</div>
            <button class="nav-item active" data-panel="topics" id="navTopics">
                <i class="fas fa-book-open"></i> Mavzular
            </button>
            <button class="nav-item" data-panel="logs" id="navLogs">
                <i class="fas fa-history"></i> Loglar
            </button>

            <div class="nav-section">Ko'rish</div>
            <button class="nav-item" onclick="window.open('mavzular-5-8.html','_blank')">
                <i class="fas fa-seedling"></i> 5–8 sinf
            </button>
            <button class="nav-item" onclick="window.open('mavzular-9-11.html','_blank')">
                <i class="fas fa-graduation-cap"></i> 9–11 sinf
            </button>
        </nav>

        <div class="sidebar-footer">
            <div class="user-chip">
                <div class="user-avatar"><i class="fas fa-user-shield"></i></div>
                <div>
                    <div class="user-name">Administrator</div>
                    <div class="user-role">Kelajak Soati Admin</div>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Chiqish
            </button>
        </div>
    </aside>

    <!-- MAIN -->
    <div class="main">
        <!-- Topbar -->
        <div class="topbar">
            <div style="display:flex;align-items:center;gap:1rem">
                <button id="menuToggle"
                    style="display:none;background:none;border:none;color:var(--text);font-size:1.2rem;cursor:pointer;padding:4px">
                    <i class="fas fa-bars"></i>
                </button>
                <span class="topbar-title" id="topbarTitle">Mavzular</span>
            </div>
            <div class="topbar-right">
                <div class="grade-tabs">
                    <button class="grade-tab active" data-grade="5-8" id="tab58">5–8 sinf</button>
                    <button class="grade-tab" data-grade="9-11" id="tab911">9–11 sinf</button>
                </div>
            </div>
        </div>

        <div class="content">

            <!-- Stats -->
            <div class="stats-row" id="statsRow">
                <div class="stat-card">
                    <div class="stat-label">5–8 mavzular</div>
                    <div class="stat-num" id="s58">—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">9–11 mavzular</div>
                    <div class="stat-num" id="s911">—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Jami mavzu</div>
                    <div class="stat-num" id="sTotal">—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Loglar</div>
                    <div class="stat-num" id="sLogs">0</div>
                </div>
            </div>

            <!-- TOPICS PANEL -->
            <div class="panel active" id="panelTopics">
                <div class="section-header">
                    <h2 id="tableTitle">5–8 sinf mavzulari</h2>
                    <button class="add-btn" id="addBtn">
                        <i class="fas fa-plus"></i> Yangi mavzu
                    </button>
                </div>
                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr>
                                <th>№ Mavzu</th>
                                <th>Mavzu nomi</th>
                                <th>Qisqa ma'lumot</th>
                                <th>Sana</th>
                                <th>Rang</th>
                                <th style="text-align:center">Amallar</th>
                            </tr>
                        </thead>
                        <tbody id="topicsBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- LOGS PANEL -->
            <div class="panel" id="panelLogs">
                <div class="section-header">
                    <h2>Amallar tarixi (Loglar)</h2>
                    <button class="add-btn"
                        style="background:rgba(239,68,68,.15);color:var(--red);box-shadow:none;border:1px solid rgba(239,68,68,.2)"
                        onclick="clearLogs()">
                        <i class="fas fa-trash"></i> Tozalash
                    </button>
                </div>
                <div class="table-wrap" id="logsWrap">
                    <div style="text-align:center;padding:3rem;color:var(--muted)">
                        <i class="fas fa-history"
                            style="font-size:2rem;opacity:.3;margin-bottom:1rem;display:block"></i>
                        Hozircha loglar yo'q
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- ADD/EDIT MODAL -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">Yangi mavzu qo'shish</span>
                <button class="modal-close" id="modalClose"><i class="fas fa-times"></i></button>
            </div>
            <form id="topicForm">
                <input type="hidden" id="editId" value="">
                <div class="form-row">
                    <div class="form-group">
                        <label>Mavzu raqami *</label>
                        <input type="number" id="fHafta" min="1" max="500" placeholder="1" required>
                    </div>
                    <div class="form-group">
                        <label>Sana *</label>
                        <input type="date" id="fDate" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Mavzu nomi *</label>
                    <input type="text" id="fTitle" placeholder="Mavzu sarlavhasi..." required>
                </div>
                <div class="form-group">
                    <label>Qisqa tavsif *</label>
                    <input type="text" id="fQisqa" placeholder="Qisqacha ma'lumot..." required>
                </div>
                <div class="form-group">
                    <label>To'liq matn (Markdown qo'llaniladi)</label>
                    <textarea id="fContent" rows="8"
                        placeholder="## Sarlavha&#10;&#10;Matn...&#10;&#10;- ro'yhat&#10;- elementi"></textarea>
                </div>
                <div class="form-group">
                    <label>Rang</label>
                    <div class="color-row">
                        <input type="color" id="fRang" value="#00c6ff">
                        <div class="color-presets">
                            <button type="button" class="cp" style="background:#00c6ff"
                                onclick="setColor('#00c6ff')"></button>
                            <button type="button" class="cp" style="background:#0072ff"
                                onclick="setColor('#0072ff')"></button>
                            <button type="button" class="cp" style="background:#a855f7"
                                onclick="setColor('#a855f7')"></button>
                            <button type="button" class="cp" style="background:#ec4899"
                                onclick="setColor('#ec4899')"></button>
                            <button type="button" class="cp" style="background:#22c55e"
                                onclick="setColor('#22c55e')"></button>
                            <button type="button" class="cp" style="background:#f59e0b"
                                onclick="setColor('#f59e0b')"></button>
                            <button type="button" class="cp" style="background:#ef4444"
                                onclick="setColor('#ef4444')"></button>
                        </div>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelBtn">Bekor qilish</button>
                <button class="btn-save" id="saveBtn"><i class="fas fa-save"></i> Saqlash</button>
            </div>
        </div>
    </div>

    <!-- DELETE CONFIRM -->
    <div class="confirm-box" id="confirmBox">
        <div class="confirm-card">
            <div class="conf-icon"><i class="fas fa-trash-alt"></i></div>
            <h3>Mavzuni o'chirish</h3>
            <p id="confirmMsg">Bu mavzuni o'chirmoqchimisiz? Amal qaytarib bo'lmaydi.</p>
            <div class="confirm-btns">
                <button class="btn-no" id="confirmNo">Bekor</button>
                <button class="btn-yes" id="confirmYes">O'chirish</button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <script>
        const API = 'api.php';
        const TOKEN_KEY = 'ks_admin_token';
        const LOGS_KEY = 'ks_admin_logs';

        let allData = { '5-8': [], '9-11': [] };
        let currentGrade = '5-8';
        let editingId = null;
        let deleteTarget = null;

        // ---- Auth check ----
        const token = localStorage.getItem(TOKEN_KEY);
        if (!token) window.location.href = 'admin-login.html';

        function authHeaders() {
            return { 'Content-Type': 'application/json', 'X-Admin-Token': token };
        }

        // ---- Logs ----
        function getLogs() {
            try { return JSON.parse(localStorage.getItem(LOGS_KEY) || '[]'); } catch { return []; }
        }
        function addLog(type, msg, grade = '') {
            const logs = getLogs();
            logs.unshift({ type, msg, grade, time: new Date().toISOString() });
            if (logs.length > 100) logs.pop();
            localStorage.setItem(LOGS_KEY, JSON.stringify(logs));
            document.getElementById('sLogs').textContent = Math.min(logs.length, 100);
            renderLogs();
        }
        function clearLogs() {
            localStorage.removeItem(LOGS_KEY);
            document.getElementById('sLogs').textContent = '0';
            renderLogs();
            showToast('Loglar tozalandi', 'info');
        }
        function renderLogs() {
            const logs = getLogs();
            const wrap = document.getElementById('logsWrap');
            if (!logs.length) {
                wrap.innerHTML = `<div style="text-align:center;padding:3rem;color:var(--muted)">
            <i class="fas fa-history" style="font-size:2rem;opacity:.3;margin-bottom:1rem;display:block"></i>
            Hozircha loglar yo'q</div>`;
                return;
            }
            const typeMap = {
                add: { icon: 'fa-plus', cls: 'add', label: 'Qo\'shildi' },
                edit: { icon: 'fa-pen', cls: 'edit', label: 'Tahrirlandi' },
                del: { icon: 'fa-trash', cls: 'del', label: 'O\'chirildi' },
                login: { icon: 'fa-sign-in-alt', cls: 'login', label: 'Kirish' },
            };
            wrap.innerHTML = logs.map(l => {
                const t = typeMap[l.type] || typeMap.login;
                const time = new Date(l.time).toLocaleString('uz-UZ');
                return `<div class="log-entry">
            <div class="log-icon ${t.cls}"><i class="fas ${t.icon}"></i></div>
            <div class="log-body">
                <div class="log-msg">${l.msg}</div>
                <div class="log-time"><i class="fas fa-clock" style="margin-right:4px"></i>${time}</div>
            </div>
            ${l.grade ? `<span class="log-grade-badge">${l.grade}</span>` : ''}
        </div>`;
            }).join('');
        }

        // ---- Data ----
        async function loadData() {
            try {
                const res = await fetch(`${API}?action=get`, { headers: authHeaders(), cache: 'no-cache' });
                if (res.ok) {
                    const j = await res.json();
                    if (j.success) { allData = j.data; localStorage.setItem('ks_data', JSON.stringify(j.data)); }
                }
            } catch {
                const cached = localStorage.getItem('ks_data');
                if (cached) allData = JSON.parse(cached);
            }
            updateStats();
            renderTable();
        }

        async function saveToServer(action, payload) {
            try {
                const res = await fetch(`${API}?action=${action}`, {
                    method: 'POST',
                    headers: authHeaders(),
                    body: JSON.stringify(payload)
                });
                const j = await res.json();
                if (j.success) return { ok: true, data: j.data };
                return { ok: false, error: j.error };
            } catch {
                return { ok: false, error: 'Server bilan bog\'lanib bo\'lmadi' };
            }
        }

        function saveLocal() {
            localStorage.setItem('ks_data', JSON.stringify(allData));
        }

        function updateStats() {
            const c58 = allData['5-8'].length;
            const c911 = allData['9-11'].length;
            document.getElementById('s58').textContent = c58;
            document.getElementById('s911').textContent = c911;
            document.getElementById('sTotal').textContent = c58 + c911;
            document.getElementById('sLogs').textContent = Math.min(getLogs().length, 100);
        }

        // ---- Table render ----
        function renderTable() {
            const body = document.getElementById('topicsBody');
            const topics = [...(allData[currentGrade] || [])].sort((a, b) => (a.hafta || 0) - (b.hafta || 0));
            document.getElementById('tableTitle').textContent =
                `${currentGrade} sinf mavzulari (${topics.length} ta)`;

            if (!topics.length) {
                body.innerHTML = `<tr><td colspan="6" class="empty-row">
            <i class="fas fa-inbox" style="font-size:2rem;opacity:.3;margin-bottom:.75rem;display:block"></i>
            Hozircha mavzu yo'q. "Yangi mavzu" tugmasini bosing.</td></tr>`;
                return;
            }

            body.innerHTML = topics.map(t => `
    <tr>
        <td><span class="badge-hafta"><i class="fas fa-hashtag"></i> ${t.hafta}</span></td>
        <td class="topic-title-cell">${esc(t.title)}</td>
        <td class="topic-qisqa-cell" title="${esc(t.qisqa)}">${esc(t.qisqa)}</td>
        <td style="color:var(--muted);font-size:.8rem">${t.date}</td>
        <td><span style="display:inline-flex;align-items:center;gap:6px">
            <span style="display:inline-block;width:18px;height:18px;border-radius:6px;background:${t.rang}"></span>
            <span style="font-size:.75rem;color:var(--muted)">${t.rang}</span>
        </span></td>
        <td>
            <div class="action-btns" style="justify-content:center">
                <button class="btn-icon btn-edit" onclick="openEdit(${t.id})" title="Tahrirlash">
                    <i class="fas fa-pen"></i>
                </button>
                <button class="btn-icon btn-del" onclick="askDelete(${t.id},'${esc(t.title)}')" title="O'chirish">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </td>
    </tr>`).join('');
        }

        function esc(s) {
            return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        // ---- Modal ----
        function openAdd() {
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Yangi mavzu qo\'shish';
            document.getElementById('editId').value = '';
            document.getElementById('fHafta').value = (allData[currentGrade].length || 0) + 1;
            document.getElementById('fDate').value = new Date().toISOString().slice(0, 10);
            document.getElementById('fTitle').value = '';
            document.getElementById('fQisqa').value = '';
            document.getElementById('fContent').value = '';
            document.getElementById('fRang').value = '#00c6ff';
            document.getElementById('modalOverlay').classList.add('open');
            setTimeout(() => document.getElementById('fTitle').focus(), 200);
        }

        function openEdit(id) {
            const t = allData[currentGrade].find(x => x.id === id);
            if (!t) return;
            editingId = id;
            document.getElementById('modalTitle').textContent = 'Mavzuni tahrirlash';
            document.getElementById('editId').value = id;
            document.getElementById('fHafta').value = t.hafta;
            document.getElementById('fDate').value = t.date;
            document.getElementById('fTitle').value = t.title;
            document.getElementById('fQisqa').value = t.qisqa;
            document.getElementById('fContent').value = t.content || '';
            document.getElementById('fRang').value = t.rang || '#00c6ff';
            document.getElementById('modalOverlay').classList.add('open');
            setTimeout(() => document.getElementById('fTitle').focus(), 200);
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('open');
        }

        function setColor(c) { document.getElementById('fRang').value = c; }
        window.setColor = setColor;

        // ---- Save ----
        document.getElementById('saveBtn').addEventListener('click', async () => {
            const title = document.getElementById('fTitle').value.trim();
            const qisqa = document.getElementById('fQisqa').value.trim();
            const hafta = parseInt(document.getElementById('fHafta').value) || 1;
            const date = document.getElementById('fDate').value;
            const content = document.getElementById('fContent').value.trim();
            const rang = document.getElementById('fRang').value;

            if (!title || !qisqa || !date) {
                showToast('Iltimos, barcha majburiy maydonlarni to\'ldiring!', 'error'); return;
            }

            const btn = document.getElementById('saveBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saqlanmoqda...';
            btn.disabled = true;

            if (editingId) {
                // TAHRIRLASH
                const payload = { grade: currentGrade, id: editingId, hafta, title, qisqa, content, date, rang };
                const res = await saveToServer('update', payload);

                const idx = allData[currentGrade].findIndex(x => x.id === editingId);
                if (idx !== -1) {
                    allData[currentGrade][idx] = { ...allData[currentGrade][idx], hafta, title, qisqa, content, date, rang };
                }
                saveLocal();
                addLog('edit', `"${title}" tahrirlandi`, currentGrade + ' sinf');
                showToast(res.ok ? 'Mavzu serverga saqlandi ✓' : 'Lokal saqlandi (server offline)', res.ok ? 'success' : 'info');

            } else {
                // QOSHISH
                const newId = allData[currentGrade].length
                    ? Math.max(...allData[currentGrade].map(x => x.id)) + 1 : 1;
                const newTopic = { id: newId, hafta, title, qisqa, content, date, rang };

                const payload = { grade: currentGrade, ...newTopic };
                const res = await saveToServer('add', payload);

                if (res.ok && res.data?.id) newTopic.id = res.data.id;
                allData[currentGrade].push(newTopic);
                saveLocal();
                addLog('add', `"${title}" qo'shildi`, currentGrade + ' sinf');
                showToast(res.ok ? 'Mavzu serverga saqlandi ✓' : 'Lokal saqlandi (server offline)', res.ok ? 'success' : 'info');
            }

            updateStats();
            renderTable();
            closeModal();
            btn.innerHTML = '<i class="fas fa-save"></i> Saqlash';
            btn.disabled = false;
        });

        // ---- Delete ----
        function askDelete(id, title) {
            deleteTarget = id;
            document.getElementById('confirmMsg').textContent = `"${title}" mavzusini o'chirmoqchimisiz?`;
            document.getElementById('confirmBox').classList.add('open');
        }
        window.askDelete = askDelete;

        document.getElementById('confirmYes').addEventListener('click', async () => {
            if (!deleteTarget) return;
            const t = allData[currentGrade].find(x => x.id === deleteTarget);
            const title = t?.title || '';

            const res = await saveToServer('delete', { grade: currentGrade, id: deleteTarget });
            allData[currentGrade] = allData[currentGrade].filter(x => x.id !== deleteTarget);
            saveLocal();
            addLog('del', `"${title}" o'chirildi`, currentGrade + ' sinf');
            showToast(res.ok ? 'Mavzu o\'chirildi ✓' : 'Lokal o\'chirildi', res.ok ? 'success' : 'info');

            updateStats();
            renderTable();
            deleteTarget = null;
            document.getElementById('confirmBox').classList.remove('open');
        });

        document.getElementById('confirmNo').addEventListener('click', () => {
            document.getElementById('confirmBox').classList.remove('open');
            deleteTarget = null;
        });

        // ---- Grade tabs ----
        document.querySelectorAll('.grade-tab').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.grade-tab').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentGrade = btn.dataset.grade;
                renderTable();
            });
        });

        // ---- Nav panels ----
        document.querySelectorAll('.nav-item[data-panel]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-item[data-panel]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const panel = btn.dataset.panel;
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                document.getElementById('panel' + panel.charAt(0).toUpperCase() + panel.slice(1)).classList.add('active');
                document.getElementById('topbarTitle').textContent = btn.textContent.trim();
                if (panel === 'logs') renderLogs();
            });
        });

        // ---- Add button ----
        document.getElementById('addBtn').addEventListener('click', openAdd);
        document.getElementById('modalClose').addEventListener('click', closeModal);
        document.getElementById('cancelBtn').addEventListener('click', closeModal);
        document.getElementById('modalOverlay').addEventListener('click', e => {
            if (e.target === document.getElementById('modalOverlay')) closeModal();
        });
        window.openEdit = openEdit;

        // ---- Logout ----
        document.getElementById('logoutBtn').addEventListener('click', () => {
            addLog('login', 'Admin tizimdan chiqdi');
            localStorage.removeItem(TOKEN_KEY);
            window.location.href = 'admin-login.html';
        });

        // ---- Toast ----
        function showToast(msg, type = 'success') {
            const t = document.getElementById('toast');
            const icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle', info: 'fa-info-circle' };
            t.className = `toast ${type}`;
            t.innerHTML = `<i class="fas ${icons[type] || icons.info}"></i> ${msg}`;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3500);
        }

        // ---- Mobile sidebar ----
        const menuToggle = document.getElementById('menuToggle');
        if (window.innerWidth <= 900) menuToggle.style.display = 'block';
        menuToggle.addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });

        // ---- Init ----
        addLog('login', 'Admin tizimga kirdi');
        loadData();
    </script>
</body>

</html>